<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="Wim Deblauwe">
<title>Error Handling Spring Boot Starter</title>
<link rel="stylesheet" href="css/site.css">
<script src="js/setup.js"></script><script defer src="js/site.js"></script>

</head>
<body class="book toc2 toc-left"><div id="banner-container" class="container" role="banner">
  <div id="banner" class="contained" role="banner">
    <div id="switch-theme">
      <input type="checkbox" id="switch-theme-checkbox" />
      <label for="switch-theme-checkbox">Dark Theme</label>
    </div>
  </div>
</div>
<div id="tocbar-container" class="container" role="navigation">
  <div id="tocbar" class="contained" role="navigation">
    <button id="toggle-toc"></button>
  </div>
</div>
<div id="main-container" class="container">
  <div id="main" class="contained">
    <div id="doc" class="doc">
<div id="header">
<h1>Error Handling Spring Boot Starter</h1>
<div class="details">
<span id="author" class="author">Wim Deblauwe</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#goal">1. Goal</a></li>
<li><a href="#getting-started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#add-the-library-to-your-project">2.1. Add the library to your project</a></li>
<li><a href="#usage">2.2. Usage</a>
<ul class="sectlevel3">
<li><a href="#default-exception-handling">2.2.1. Default <code>Exception</code> handling</a></li>
<li><a href="#validation-exception-handling">2.2.2. Validation exception handling</a></li>
<li><a href="#with-springboottest">2.2.3. With <code>@SpringBootTest</code></a></li>
<li><a href="#with-webmvctest">2.2.4. With <code>@WebMvcTest</code></a></li>
<li><a href="#with-webfluxtest">2.2.5. With <code>@WebFluxTest</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration">3. Configuration</a>
<ul class="sectlevel2">
<li><a href="#http-response-status">3.1. HTTP response status</a>
<ul class="sectlevel3">
<li><a href="#set-http-response-status-via-responsestatus">3.1.1. Set HTTP response status via <code>@ResponseStatus</code></a></li>
<li><a href="#set-http-response-status-via-properties">3.1.2. Set HTTP response status via properties</a></li>
<li><a href="#use-responsestatusexception">3.1.3. Use <code>ResponseStatusException</code></a></li>
<li><a href="#add-http-response-status-in-json-response">3.1.4. Add HTTP response status in JSON response</a></li>
</ul>
</li>
<li><a href="#error-codes">3.2. Error codes</a>
<ul class="sectlevel3">
<li><a href="#error-code-style">3.2.1. Error code style</a></li>
<li><a href="#general-override-of-error-codes">3.2.2. General override of error codes</a></li>
<li><a href="#per-class-override-of-error-code">3.2.3. Per class override of error code</a></li>
<li><a href="#general-override-of-validation-error-codes">3.2.4. General override of validation error codes</a></li>
<li><a href="#field-specific-override-of-validation-error-codes">3.2.5. Field specific override of validation error codes</a></li>
</ul>
</li>
<li><a href="#error-messages">3.3. Error messages</a>
<ul class="sectlevel3">
<li><a href="#default-behaviour">3.3.1. Default behaviour</a></li>
<li><a href="#general-override-of-error-messages">3.3.2. General override of error messages</a></li>
<li><a href="#field-specific-override-of-error-messages">3.3.3. Field specific override of error messages</a></li>
</ul>
</li>
<li><a href="#super-class-hierarchy-search">3.4. Super class hierarchy search</a>
<ul class="sectlevel3">
<li><a href="#reset-back-to-default-messaging-at-a-point-in-exception-class-hierarchy">3.4.1. Reset back to default messaging at a point in exception class hierarchy</a></li>
</ul>
</li>
<li><a href="#exception-handlers">3.5. Exception handlers</a>
<ul class="sectlevel3">
<li><a href="#validation">3.5.1. Validation</a></li>
<li><a href="#unreadable-http-message">3.5.2. Unreadable HTTP message</a></li>
<li><a href="#type-conversion-exceptions">3.5.3. Type conversion exceptions</a></li>
<li><a href="#optimistic-locking-exceptions">3.5.4. Optimistic locking exceptions</a></li>
<li><a href="#spring-security-exceptions">3.5.5. Spring Security exceptions</a></li>
</ul>
</li>
<li><a href="#adding-extra-properties-in-the-response">3.6. Adding extra properties in the response</a>
<ul class="sectlevel3">
<li><a href="#via-method-annotation">3.6.1. Via method annotation</a></li>
<li><a href="#via-field-annotation">3.6.2. Via field annotation</a></li>
<li><a href="#overriding-the-property-name">3.6.3. Overriding the property name</a></li>
<li><a href="#null-handling">3.6.4. Null handling</a></li>
<li><a href="#global-customization-of-the-response-json">3.6.5. Global customization of the response JSON</a></li>
</ul>
</li>
<li><a href="#custom-json-response-field-names">3.7. Custom JSON response field names</a></li>
<li><a href="#logging">3.8. Logging</a></li>
<li><a href="#spring-security">3.9. Spring Security</a>
<ul class="sectlevel3">
<li><a href="#authenticationentrypoint">3.9.1. AuthenticationEntryPoint</a></li>
<li><a href="#accessdeniedhandler">3.9.2. AccessDeniedHandler</a></li>
</ul>
</li>
<li><a href="#handle-non-rest-controller-exceptions">3.10. Handle non-rest controller exceptions</a></li>
<li><a href="#handle-filter-exceptions">3.11. Handle filter exceptions</a></li>
</ul>
</li>
<li><a href="#custom-exception-handler">4. Custom exception handler</a></li>
<li><a href="#properties">5. Properties</a></li>
<li><a href="#support">6. Support</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This documentation is for version 4.4.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="goal"><a class="anchor" href="#goal"></a>1. Goal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal of the project is to make it easy to have proper error responses for REST APIs built with Spring Boot.
Just like Spring Boot itself, it takes an opinionated approach to how the response body should look like in the case of an error.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started"><a class="anchor" href="#getting-started"></a>2. Getting started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="add-the-library-to-your-project"><a class="anchor" href="#add-the-library-to-your-project"></a>2.1. Add the library to your project</h3>
<div class="paragraph">
<p>The library is available on <a href="https://mvnrepository.com/artifact/io.github.wimdeblauwe/error-handling-spring-boot-starter">Maven Central</a>, so it is easy to add the dependency to your project.</p>
</div>
<div class="listingblock primary">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.github.wimdeblauwe&lt;/groupId&gt;
    &lt;artifactId&gt;error-handling-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;LATEST_VERSION_HERE&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code>compile 'io.github.wimdeblauwe:error-handling-spring-boot-starter:LATEST_VERSION_HERE'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This library is indented to be used with a <a href="https://spring.io/projects/spring-boot">Spring Boot</a> project.
It will not work outside of a Spring Boot project.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="usage"><a class="anchor" href="#usage"></a>2.2. Usage</h3>
<div class="sect3">
<h4 id="default-exception-handling"><a class="anchor" href="#default-exception-handling"></a>2.2.1. Default <code>Exception</code> handling</h4>
<div class="paragraph">
<p>By adding the library on the classpath, it will become active.
It registers an <code>@ControllerAdvice</code> bean in the context that will act if an exception is thrown from a <code>@RestController</code> method.</p>
</div>
<div class="paragraph">
<p>Suppose there is a custom Exception like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.company.application.user;

public class UserNotFoundException extends RuntimeException {
    public UserNotFoundException(UserId userId) {
        super("Could not find user with id " + userId);
    }
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>When this <code>UserNotFoundException</code> is thrown from a controller method, the library will return a JSON response like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id 123"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The HTTP status code will be <em>500 Internal Server Error</em>.</p>
</div>
<div class="paragraph">
<p>Next to this quite simple default behaviour, there is special handling for some of the common Spring exceptions and there is an extensive amount of <a href="#configuration">customization options</a> that should make this library a good fit for all of your error handling for REST controllers.</p>
</div>
<div class="paragraph">
<p>This works for <code>@RestController</code> classes that are <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#spring-web">servlet based</a> and for those that use <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web-reactive.html">Spring WebFlux</a> (reactive).</p>
</div>
</div>
<div class="sect3">
<h4 id="validation-exception-handling"><a class="anchor" href="#validation-exception-handling"></a>2.2.2. Validation exception handling</h4>
<div class="paragraph">
<p>For some exceptions like <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/MethodArgumentNotValidException.html"><code>MethodArgumentNotValidException</code></a>, <a href="https://docs.oracle.com/javaee/7/api/javax/validation/ConstraintViolationException.html"><code>ConstraintViolationException</code></a>,&#8230;&#8203; there is special handling and extra information is returned in the response.</p>
</div>
<div class="paragraph">
<p>For example, suppose you have this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ExampleRequestBody {
    @Size(min = 10)
    private String name;
    @NotBlank
    private String favoriteMovie;

    // getters and setters
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which is used as a request body in a controller like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import jakarta.validation.Valid;

</span><span class="fold-block">@RestController
@RequestMapping("/example")
public class MyExampleController {

    @PostMapping
    public MyResponse doSomething(@Valid @RequestBody ExampleRequestBody requestBody ) {
        // ...
    }
}
</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When sending a JSON request body like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "name": "",
    "favoriteMovie": null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation fails, and the following JSON response will be returned:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='exampleRequestBody'. Error count: 2",
  "fieldErrors": [
    {
      "code": "INVALID_SIZE",
      "property": "name",
      "message": "size must be between 10 and 2147483647",
      "rejectedValue": "",
      "path": "name"
    },
    {
      "code": "REQUIRED_NOT_BLANK",
      "property": "favoriteMovie",
      "message": "must not be blank",
      "rejectedValue": null,
      "path": "favoriteMovie"
    }
  ]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If there are validation errors on the class level, they will be added in the response as <code>globalErrors</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="with-springboottest"><a class="anchor" href="#with-springboottest"></a>2.2.3. With <code>@SpringBootTest</code></h4>
<div class="paragraph">
<p>There is nothing special to configure for unit tests that use <code>@SpringBootTest</code>.
The library is automatically active when it is on the classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="with-webmvctest"><a class="anchor" href="#with-webmvctest"></a>2.2.4. With <code>@WebMvcTest</code></h4>
<div class="paragraph">
<p>There is nothing special to configure for unit tests that use <code>@WebMvcTest</code>.
The library is automatically active when it is on the classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="with-webfluxtest"><a class="anchor" href="#with-webfluxtest"></a>2.2.5. With <code>@WebFluxTest</code></h4>
<div class="paragraph">
<p>There is nothing special to configure for unit tests that use <code>@WebFluxTest</code>.
The library is automatically active when it is on the classpath.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a>3. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="http-response-status"><a class="anchor" href="#http-response-status"></a>3.1. HTTP response status</h3>
<div class="sect3">
<h4 id="set-http-response-status-via-responsestatus"><a class="anchor" href="#set-http-response-status-via-responsestatus"></a>3.1.1. Set HTTP response status via <code>@ResponseStatus</code></h4>
<div class="paragraph">
<p>The library uses <em>500 Internal Server Error</em> as HTTP response code by default, just like Spring Boot does.</p>
</div>
<div class="paragraph">
<p>To set a specific status code, you can use <code>@ResponseStatus</code>, which is also standard Spring Boot behaviour.
The library will honor what is set there.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block">package com.company.application.user;

</span><span class="fold-block hide-when-folded">import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ResponseStatus;

</span><span class="fold-block">@ResponseStatus(HttpStatus.NOT_FOUND) <i class="conum" data-value="1"></i><b>(1)</b>
public class UserNotFoundException extends RuntimeException {
    public UserNotFoundException(UserId userId) {
        super("Could not find user with id " + userId);
    }
}
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Specify the HTTP response status via a class level annotation.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="set-http-response-status-via-properties"><a class="anchor" href="#set-http-response-status-via-properties"></a>3.1.2. Set HTTP response status via properties</h4>
<div class="paragraph">
<p>Use the <code>error.handling.http-statuses</code> property to set the HTTP response status without adding an annotation to the sources of the Exception class itself.
This is mostly useful if you don&#8217;t control the sources of the Exception.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.http-statuses.java.lang.IllegalArgumentException=bad_request</code></pre>
</div>
</div>
<div class="paragraph">
<p>By setting this, any <code>IllegalArgumentException</code> that happens will have a <em>400 Bad Request</em> response code.
The values are the enum values from <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.html"><code>org.springframework.http.HttpStatus</code></a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="use-responsestatusexception"><a class="anchor" href="#use-responsestatusexception"></a>3.1.3. Use <code>ResponseStatusException</code></h4>
<div class="paragraph">
<p>When the exception class is <code>org.springframework.web.server.ResponseStatusException</code> (or one of the sub-classes), then the response status is taken from the status set on the Exception itself.</p>
</div>
<div class="paragraph">
<p>As an example, when a <code>MethodNotAllowedException</code> is thrown, this is the resulting JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "METHOD_NOT_ALLOWED",
  "message": "405 METHOD_NOT_ALLOWED \"Request method 'OPTIONS' not supported\""
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the response code will be <em>405 Method Not Allowed</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="add-http-response-status-in-json-response"><a class="anchor" href="#add-http-response-status-in-json-response"></a>3.1.4. Add HTTP response status in JSON response</h4>
<div class="paragraph">
<p>It is possible to add the HTTP response status in the JSON response payload itself as well.
This is not the case by default.
To enable this, set the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.http-status-in-json-response=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting JSON response will now be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "status": 404,
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id 123"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="error-codes"><a class="anchor" href="#error-codes"></a>3.2. Error codes</h3>
<div class="sect3">
<h4 id="error-code-style"><a class="anchor" href="#error-code-style"></a>3.2.1. Error code style</h4>
<div class="paragraph">
<p>By default, the full qualified name of the <code>Exception</code> class is converted to ALL_CAPS to be used as the <code>code</code> in the response.</p>
</div>
<div class="paragraph">
<p>If you like to use the plain full qualified name style for the codes, then specify this property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.default-error-code-strategy=FULL_QUALIFIED_NAME</code></pre>
</div>
</div>
<div class="paragraph">
<p>For a class called <code>UserNotFoundException</code>, this default style (<code>ALL_CAPS</code>) will result in the following JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id 123"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using <code>FULL_QUALIFIED_NAME</code>, the result will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "com.company.application.user.UserNotFoundException",
  "message": "Could not find user with id 123"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="general-override-of-error-codes"><a class="anchor" href="#general-override-of-error-codes"></a>3.2.2. General override of error codes</h4>
<div class="paragraph">
<p>If the default <a href="#error-code-style">Error code style</a> is not enough for what you need, you can set a code via the properties by using the full qualified name under the <code>error.handling.codes</code> key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.codes.java.lang.IllegalArgumentException=ILLEGAL_ARGUMENT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "ILLEGAL_ARGUMENT",
  "message": "argument was not as expected"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is mostly useful for <code>Exception</code> types that are not under your own control (E.g. they are coming from a library that you use).
If you do have control, it is probably easier to use <a href="#per-class-override-of-error-code">Per class override of error code</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="per-class-override-of-error-code"><a class="anchor" href="#per-class-override-of-error-code"></a>3.2.3. Per class override of error code</h4>
<div class="paragraph">
<p>By adding the <code>@ResponseErrorCode</code> annotation as a class level annotation, it is possible to define the <code>code</code> that the response will be using.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block">package com.company.application.user;

</span><span class="fold-block hide-when-folded">import io.github.wimdeblauwe.errorhandlingspringbootstarter.ResponseErrorCode;

</span><span class="fold-block">@ResponseErrorCode("COULD_NOT_FIND_USER")
public class UserNotFoundException extends RuntimeException {
    public UserNotFoundException(UserId userId) {
        super("Could not find user with id " + userId);
    }
}
</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in this response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "COULD_NOT_FIND_USER",
  "message": "Could not find user with id 123"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="general-override-of-validation-error-codes"><a class="anchor" href="#general-override-of-validation-error-codes"></a>3.2.4. General override of validation error codes</h4>
<div class="paragraph">
<p>The library has codes defined for all <a href="https://docs.oracle.com/javaee/7/api/javax/validation/constraints/package-summary.html">jakarta.validation.constraints</a> annotations.
It is possible to override those via the <code>application.properties</code>.</p>
</div>
<div class="paragraph">
<p>The default <code>code</code> for <code>@Size</code> is <code>INVALID_SIZE</code>, but if you want to change this to <code>SIZE_REQUIREMENT_NOT_MET</code>, then define the following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.codes.Size=SIZE_REQUIREMENT_NOT_MET</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there is now a validation error for <code>@Size</code>, then the response body will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='exampleRequestBody'. Error count: 1",
  "fieldErrors": [
    {
      "code": "SIZE_REQUIREMENT_NOT_MET", <i class="conum" data-value="1"></i><b>(1)</b>
      "property": "name",
      "message": "size must be between 10 and 2147483647",
      "rejectedValue": "",
      "path": "name"
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom code used for the field error</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="field-specific-override-of-validation-error-codes"><a class="anchor" href="#field-specific-override-of-validation-error-codes"></a>3.2.5. Field specific override of validation error codes</h4>
<div class="paragraph">
<p>It is possible to configure a specific error code that only will be used for a combination of a field with a validation annotation.</p>
</div>
<div class="paragraph">
<p>Suppose you add a regex to validate password rules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CreateUserRequestBody {
    @Pattern(".*{8}")
    private String password;

    // getters and setters
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, this error is in the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='createUserRequestBody'. Error count: 1",
  "fieldErrors": [
    {
      "code": "REGEX_PATTERN_VALIDATION_FAILED",
      "property": "password",
      "message": "must match \".*{8}\"",
      "rejectedValue": "",
      "path": "password"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we would use <code>error.handling.codes.Pattern</code> for the override, then all <code>@Pattern</code> annotations in the whole application would use a different code.
If we want to only override this for fields that are named <code>password</code>, we can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.codes.password.Pattern=PASSWORD_COMPLEXITY_REQUIREMENTS_NOT_MET</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='createUserRequestBody'. Error count: 1",
  "fieldErrors": [
    {
      "code": "PASSWORD_COMPLEXITY_REQUIREMENTS_NOT_MET",
      "property": "password",
      "message": "must match \".*{8}\"",
      "rejectedValue": "",
      "path": "password"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="error-messages"><a class="anchor" href="#error-messages"></a>3.3. Error messages</h3>
<div class="sect3">
<h4 id="default-behaviour"><a class="anchor" href="#default-behaviour"></a>3.3.1. Default behaviour</h4>
<div class="paragraph">
<p>The library will output the <code>message</code> property of the Exception into the <code>message</code> JSON field by default.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package com.company.application.user;

public class UserNotFoundException extends RuntimeException {
    public UserNotFoundException(UserId userId) {
        super("Could not find user with id " + userId);
    }
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response JSON:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id 123" <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The output uses the <code>message</code> of the Exception by default.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="general-override-of-error-messages"><a class="anchor" href="#general-override-of-error-messages"></a>3.3.2. General override of error messages</h4>
<div class="paragraph">
<p>By using <code>error.handling.messages</code> property, it is possible to globally set an error message for a certain exception.
This is most useful for the validation messages.</p>
</div>
<div class="paragraph">
<p>Suppose you have this defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.messages.NotBlank=The property should not be blank</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the <code>message</code> in the output is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='exampleRequestBody'. Error count: 1",
  "fieldErrors": [
    {
      "code": "REQUIRED_NOT_BLANK",
      "property": "name",
      "message": "The property should not be blank",<i class="conum" data-value="1"></i><b>(1)</b>
      "rejectedValue": "",
      "path": "name"
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom message used for the field error</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So you start with <code>error.handling.messages</code> and suffix with the name of the validation annotation used (<code>@NotBlank</code> in the above example).</p>
</div>
</div>
<div class="sect3">
<h4 id="field-specific-override-of-error-messages"><a class="anchor" href="#field-specific-override-of-error-messages"></a>3.3.3. Field specific override of error messages</h4>
<div class="paragraph">
<p>It is possible to configure a specific error message that only will be used for a combination of a field with a validation annotation.</p>
</div>
<div class="paragraph">
<p>Suppose you add a regex to validate password rules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CreateUserRequestBody {
    @Pattern(".*{8}")
    private String password;

    // getters and setters
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, this error is in the response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='createUserRequestBody'. Error count: 1",
  "fieldErrors": [
    {
      "code": "REGEX_PATTERN_VALIDATION_FAILED",
      "property": "password",
      "message": "must match \".*{8}\"",
      "rejectedValue": "",
      "path": "password"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we would use <code>error.handling.messages.Pattern</code> for the override, then all <code>@Pattern</code> annotations in the whole application would use a different message.
If we want to only override this for fields that are named <code>password</code>, we can use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.messages.password.Pattern=The password complexity rules are not met. A password must be 8 characters minimum.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='createUserRequestBody'. Error count: 1",
  "fieldErrors": [
    {
      "code": "REGEX_PATTERN_VALIDATION_FAILED",
      "property": "password",
      "message": "The password complexity rules are not met. A password must be 8 characters minimum.", <i class="conum" data-value="1"></i><b>(1)</b>
      "rejectedValue": "",
      "path": "password"
    }
  ]
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Custom error message used in the response</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="super-class-hierarchy-search"><a class="anchor" href="#super-class-hierarchy-search"></a>3.4. Super class hierarchy search</h3>
<div class="paragraph">
<p>By default, the library will only match <a href="#http-response-status">HTTP response status</a>, <a href="#error-codes">Error codes</a> or <a href="#error-messages">Error messages</a> settings in the properties when there is an exact match with the full qualified name of the <code>Exception</code>.</p>
</div>
<div class="paragraph">
<p>If you want to define settings for a group of Exceptions that share a common superclass, then this is possible by enabling the <code>error.handling.search-super-class-hierarchy</code> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.search-super-class-hierarchy=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this in place, we can for instance set the properties for any <code>RuntimeException</code> sub-class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.http-statuses.java.lang.RuntimeException=bad_request
error.handling.codes.java.lang.RuntimeException=RUNTIME_EXCEPTION
error.handling.messages.java.lang.RuntimeException=A runtime exception has happened</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assume this exception is thrown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class MyException extends RuntimeException {}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then the response will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "RUNTIME_EXCEPTION",
  "message": "A runtime exception has happened"
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="reset-back-to-default-messaging-at-a-point-in-exception-class-hierarchy"><a class="anchor" href="#reset-back-to-default-messaging-at-a-point-in-exception-class-hierarchy"></a>3.4.1. Reset back to default messaging at a point in exception class hierarchy</h4>
<div class="paragraph">
<p>Consider that case where you have an exception like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class ApplicationException extends RuntimeException {}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>but you already have the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.messages.java.lang.RuntimeException=A runtime exception has happened
error.handling.search-super-class-hierarchy=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may reset back to default error messaging from a certain point in the class hierarchy (say
<code>my.ApplicationException</code>) by providing an empty value for that exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.messages.my.ApplicationException=</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, <code>ApplicationException</code> and its subclasses will fall back to default messaging behaviour, rather than always showing "A runtime exception has happened".</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exception-handlers"><a class="anchor" href="#exception-handlers"></a>3.5. Exception handlers</h3>
<div class="sect3">
<h4 id="validation"><a class="anchor" href="#validation"></a>3.5.1. Validation</h4>
<div class="paragraph">
<p>There are 4 cases that this library will create specific JSON responses when validation errors occur:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When using <code>@Valid</code> in the parameter of a controller method for a request body.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import jakarta.validation.Valid;

</span><span class="fold-block">@RestController
@RequestMapping("/example")
public class MyExampleController {

    @PostMapping
    public MyResponse doSomething(@Valid @RequestBody ExampleRequestBody requestBody ) {
        // ...
    }
}
</span></code></pre>
</div>
</div>
</li>
<li>
<p>When annotating an <code>@RequestParam</code> parameter with extra validation annotations.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import jakarta.validation.Valid;

</span><span class="fold-block">@RestController
@RequestMapping("/example")
@Validated
public class MyExampleController {

    @GetMapping
    public MyResponse doSomething(@NotBlank @RequestParam("param") String param ) {
        // ...
    }
}
</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You need to add <code>org.springframework.validation.annotation.Validated</code> annotation on the <em>controller</em> class otherwise, the validation annotations on the request parameter will not work.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>When using <code>@Valid</code> in the parameter of a controller method for a class that is mapped to request parameters.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import jakarta.validation.Valid;

</span><span class="fold-block">@RestController
@RequestMapping("/example")
public class MyExampleController {

    @GetMapping
    public MyResponse doSomething(@Valid ExampleRequestParameters requestParameters ) {
        // ...
    }
}
</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>TestRequestBody</code> would have standard or custom validation annotations.</p>
</div>
</li>
<li>
<p>When using validation annotations on Spring components that are themselves annotated with <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/validation/annotation/Validated.html"><code>@Validated</code></a>.
For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import org.springframework.stereotype.Service;
import org.springframework.validation.annotation.Validated;
import jakarta.validation.Valid;
import jakarta.validation.constraints.NotNull;

</span><span class="fold-block">@Service
@Validated
public static class TestService {
    void doSomething(@Valid TestRequestBody requestBody,
                     @NotNull String extraArg) {

    }
}
</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In all cases, the response JSON will be similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='exampleRequestBody'. Error count: 4",
  "fieldErrors": [
    {
      "code": "INVALID_SIZE",
      "property": "name",
      "message": "size must be between 10 and 2147483647",
      "rejectedValue": "",
      "path": "name"
    },
    {
      "code": "REQUIRED_NOT_BLANK",
      "property": "favoriteMovie",
      "message": "must not be blank",
      "rejectedValue": null,
      "path": "favoriteMovie"
    }
  ],
  "globalErrors": [
    {
      "code": "ValidCustomer",
      "message": "Invalid customer"
    },
    {
      "code": "ValidCustomer",
      "message": "UserAlreadyExists"
    }
  ],
  "parameterErrors": [
    {
      "code": "REQUIRED_NOT_NULL",
      "message": "must not be null",
      "parameter": "extraArg",
      "rejectedValue": null
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Breakdown:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>code</code> is always <code>VALIDATION_FAILED</code> (unless there was an override defined)</p>
</li>
<li>
<p>The <code>message</code> indicates what object failed the validation and also indicates the amount of validation errors.</p>
</li>
<li>
<p>The <code>fieldErrors</code> array contains all field-level validation problems.
It shows the name of the property that failed the validation and the value that was received in the request.</p>
</li>
<li>
<p>The <code>parameterErrors</code> array contains all the parameter-level validation problems.
It shows the name of the parameter that failed the validation and the value that was received in the request.</p>
</li>
<li>
<p>The <code>globalErrors</code> array contains the class-level validation problems.</p>
<div class="paragraph">
<p>The <code>code</code> and <code>message</code> used for <code>globalErrors</code> is based on the annotation that was used for validation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = CustomerValidator.class)
public @interface ValidCustomer {
    String message() default "Invalid customer";

    Class&lt;?&gt;[] groups() default {};

    Class&lt;? extends Payload&gt;[] payload() default {};
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As well as the template that is used in the validator itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class CustomerValidator implements ConstraintValidator&lt;ValidCustomer, CreateCustomerFormData&gt; {
    @Override
    public boolean isValid(CreateCustomerFormData formData, ConstraintValidatorContext context) {

        if(...) {
            context.buildConstraintViolationWithTemplate("UserAlreadyExists").addConstraintViolation();
        }
    }
}
</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to change the message for the global errors, the default Spring mechanism for that keeps working.</p>
</div>
<div class="paragraph">
<p>So use <code>{}</code> to indicate that Spring should search the <code>messages.properties</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">context.buildConstraintViolationWithTemplate("{UserAlreadyExists}").addConstraintViolation();
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now add the translation to the <code>messages.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">UserAlreadyExists=The user already exists</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "VALIDATION_FAILED",
  "message": "Validation failed for object='exampleRequestBody'. Error count: 2",
  "globalErrors": [
    {
      "code": "INVALID_CUSTOMER",
      "message": "Invalid customer"
    },
    {
      "code": "INVALID_CUSTOMER",
      "message": "The user already exists"
    }
  ]
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="unreadable-http-message"><a class="anchor" href="#unreadable-http-message"></a>3.5.2. Unreadable HTTP message</h4>
<div class="paragraph">
<p>If a controller receives a message that it cannot read, because the JSON is invalid for example, then a <code>HttpMessageNotReadableException</code> is thrown.
When this happens, the library will return something like the following response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "MESSAGE_NOT_READABLE",
  "message": "JSON parse error: Unexpected character ('i' (code 105)): was expecting double-quote to start field name; nested exception is com.fasterxml.jackson.core.JsonParseException: Unexpected character ('i' (code 105)): was expecting double-quote to start field name\n at [Source: (PushbackInputStream); line: 1, column: 3]"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="type-conversion-exceptions"><a class="anchor" href="#type-conversion-exceptions"></a>3.5.3. Type conversion exceptions</h4>
<div class="paragraph">
<p>Type conversion exceptions like <code>MethodArgumentTypeMismatchException</code> and <code>TypeMismatchException</code> will have some extra info about the class that was expected and the value that was rejected:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "ARGUMENT_TYPE_MISMATCH",
  "message": "Failed to convert value of type 'java.lang.String' to required type 'com.example.user.UserId'; nested exception is org.springframework.core.convert.ConversionFailedException: Failed to convert from type [java.lang.String] to type [@org.springframework.web.bind.annotation.PathVariable com.example.user.UserId] for value 'fake_UUID'; nested exception is java.lang.IllegalArgumentException: Invalid UUID string: fake_UUID",
  "expectedType": "com.example.user.UserId",
  "property": "userId",
  "rejectedValue": "fake_UUID"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="optimistic-locking-exceptions"><a class="anchor" href="#optimistic-locking-exceptions"></a>3.5.4. Optimistic locking exceptions</h4>
<div class="paragraph">
<p>When an <code>org.springframework.orm.ObjectOptimisticLockingFailureException</code> is thrown, the resulting response will be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "OPTIMISTIC_LOCKING_ERROR",
  "message": "Object of class [com.example.user.User] with identifier [87518c6b-1ba7-4757-a5d9-46e84c539f43]: optimistic locking failed",
  "identifier": "87518c6b-1ba7-4757-a5d9-46e84c539f43",
  "persistentClassName": "com.example.user.User"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="spring-security-exceptions"><a class="anchor" href="#spring-security-exceptions"></a>3.5.5. Spring Security exceptions</h4>
<div class="paragraph">
<p>If Spring Security is on the classpath, then those exceptions will be handled.
They will just have a <code>code</code> and a <code>message</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "ACCESS_DENIED",
  "message": "Access is denied"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full list of Exception types that are handled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AccessDeniedException</p>
</li>
<li>
<p>AccountExpiredException</p>
</li>
<li>
<p>AuthenticationCredentialsNotFoundException</p>
</li>
<li>
<p>AuthenticationServiceException</p>
</li>
<li>
<p>BadCredentialsException</p>
</li>
<li>
<p>UsernameNotFoundException</p>
</li>
<li>
<p>InsufficientAuthenticationException</p>
</li>
<li>
<p>LockedException</p>
</li>
<li>
<p>DisabledException</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="adding-extra-properties-in-the-response"><a class="anchor" href="#adding-extra-properties-in-the-response"></a>3.6. Adding extra properties in the response</h3>
<div class="paragraph">
<p>It is possible to add extra properties in the JSON response by using the <code>@ErrorResponseProperty</code> annotation in your custom Exception class.</p>
</div>
<div class="sect3">
<h4 id="via-method-annotation"><a class="anchor" href="#via-method-annotation"></a>3.6.1. Via method annotation</h4>
<div class="paragraph">
<p>This example annotates the <code>getUserId()</code> method with <code>@ResponseErrorProperty</code> so that the return value of the method is added to the JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ResponseStatus(HttpStatus.NOT_FOUND)
@ResponseErrorCode("USER_NOT_FOUND")
public class UserNotFoundException extends RuntimeException {

    private final UserId userId;

    public UserNotFoundException(UserId userId) {
        super(String.format("Could not find user with id %s", userId));
        this.userId = userId;
    }

    @ResponseErrorProperty <i class="conum" data-value="1"></i><b>(1)</b>
    public String getUserId() {
        return userId.getValue();
    }
}
</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the result of this method as an extra property in the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id UserId{id=8c7fb13c-0924-47d4-821a-36f73558c898}",
  "userId": "8c7fb13c-0924-47d4-821a-36f73558c898"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="via-field-annotation"><a class="anchor" href="#via-field-annotation"></a>3.6.2. Via field annotation</h4>
<div class="paragraph">
<p>This example annotates the <code>userId</code> field with <code>@ResponseErrorProperty</code> so that the value of the field is added to the JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ResponseStatus(HttpStatus.NOT_FOUND)
@ResponseErrorCode("USER_NOT_FOUND")
public class UserNotFoundException extends RuntimeException {

    @ResponseErrorProperty <i class="conum" data-value="1"></i><b>(1)</b>
    private final UserId userId;

    public UserNotFoundException(UserId userId) {
        super(String.format("Could not find user with id %s", userId));
        this.userId = userId;
    }
}
</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add the result of this method as an extra property in the response</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id UserId{id=8c7fb13c-0924-47d4-821a-36f73558c898}",
  "userId": "8c7fb13c-0924-47d4-821a-36f73558c898"
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The annotated field can be <code>public</code> or <code>private</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="overriding-the-property-name"><a class="anchor" href="#overriding-the-property-name"></a>3.6.3. Overriding the property name</h4>
<div class="paragraph">
<p>It is also possible to override the property name that will be used in the response by using the <code>value</code> argument of the annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ResponseStatus(HttpStatus.NOT_FOUND)
@ResponseErrorCode("USER_NOT_FOUND")
public class UserNotFoundException extends RuntimeException {

    ...

    @ResponseErrorProperty("id")
    public String getUserId() {
        return userId.asString();
    }
}
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id UserId{id=8c7fb13c-0924-47d4-821a-36f73558c898}",
  "id": "8c7fb13c-0924-47d4-821a-36f73558c898"
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="null-handling"><a class="anchor" href="#null-handling"></a>3.6.4. Null handling</h4>
<div class="paragraph">
<p>If a property or method that is annotated with <code>@ResponseErrorProperty</code> returns <code>null</code>, then the JSON output will not contain the property by default.
If this is desirable, then use the <code>includeIfNull</code> property on the annotation to change this behaviour:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ResponseStatus(HttpStatus.NOT_FOUND)
@ResponseErrorCode("USER_NOT_FOUND")
public class UserNotFoundException extends RuntimeException {

    private final UserId userId;

    public UserNotFoundException(UserId userId) {
        super(String.format("Could not find user with id %s", userId));
        this.userId = userId;
    }

    @ResponseErrorProperty(includeIfNull=true) <i class="conum" data-value="1"></i><b>(1)</b>
    public String getUserId() {
        return userId.asString();
    }
}
</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Set the <code>includeIfNull</code> setting to <code>true</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting response assuming the passed in <code>userId</code> is <code>null</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id UserId{id=8c7fb13c-0924-47d4-821a-36f73558c898}",
  "userId": null
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="global-customization-of-the-response-json"><a class="anchor" href="#global-customization-of-the-response-json"></a>3.6.5. Global customization of the response JSON</h4>
<div class="paragraph">
<p>The previous methods can only be used if you have access to the source code of the exception class.
If you want to add some property globally for all exceptions, also those from libraries you import, then you can implement an <code>ApiErrorResponseCustomizer</code>.</p>
</div>
<div class="paragraph">
<p>For example, suppose you want to add a timestamp to all error responses.
You can do so by declaring the following bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public ApiErrorResponseCustomizer timestampErrorResponseCustomizer() {
        return new ApiErrorResponseCustomizer() {
            @Override
            public void customize(ApiErrorResponse response) {
                response.addErrorProperty("instant", Instant.now());
            }
        };
    }
</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example resulting response could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "USER_NOT_FOUND",
  "message": "Could not find user with id UserId{id=8c7fb13c-0924-47d4-821a-36f73558c898}",
  "instant": "2023-06-14T06:20:12.719357Z"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can declare multiple such beans in your application.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="custom-json-response-field-names"><a class="anchor" href="#custom-json-response-field-names"></a>3.7. Custom JSON response field names</h3>
<div class="paragraph">
<p>If the <code>code</code>, <code>message</code>, <code>fieldErrors</code> and/or <code>globalErrors</code> field names are not to your liking, then you can customize those through the following properties:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.json-field-names.code=errorCode
error.handling.json-field-names.message=description
error.handling.json-field-names.field-errors=fieldFailures
error.handling.json-field-names.global-errors=classFailures</code></pre>
</div>
</div>
<div class="paragraph">
<p>With these settings, a response will look similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "errorCode": "VALIDATION_FAILED",
  "description": "Validation failed for object='exampleRequestBody'. Error count: 4",
  "fieldFailures": [
    {
      "code": "INVALID_SIZE",
      "property": "name",
      "message": "size must be between 10 and 2147483647",
      "rejectedValue": "",
      "path": "name"
    }
  ],
  "classFailures": [
    {
      "code": "ValidCustomer",
      "message": "UserAlreadyExists"
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="logging"><a class="anchor" href="#logging"></a>3.8. Logging</h3>
<div class="paragraph">
<p>The library will log a single line to the configured logging output for each Exception that is handled.
This behaviour can be changed to log either nothing at all (<code>NO_LOGGING</code>), or to log full stack traces (<code>WITH_STACKTRACE</code>) via the <code>error.handling.exception-logging</code> property.</p>
</div>
<div class="paragraph">
<p>If you want to keep logging minimal, but still have a full stacktrace for some exceptions, then you can use the <code>error.handling.full-stacktrace-classes</code> property like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.exception-logging=MESSAGE_ONLY
error.handling.full-stacktrace-classes[0]=java.lang.NullPointerException
error.handling.full-stacktrace-classes[1]=org.springframework.http.converter.HttpMessageNotReadableException</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, all exceptions will have a single log line in the logging output, but <code>NullPointerException</code> and <code>HttpMessageNotReadableException</code> will have full stack traces printed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only the exact matches of the listed classes are used, not the subclasses of the specified classes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another way to have additional logging is to specify a list of HTTP return codes that you want full stack traces for:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.full-stacktrace-http-statuses[0]=5xx
error.handling.full-stacktrace-http-statuses[1]=403</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration will print a full stack trace for all errors in the 5xx range and for the exact 403 error code.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The logging that is done on the response codes is <em>additionally</em> to the logging done on the exception type.
You might want to only enable one of the two to avoid double stack traces.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to define on what log level the exception message (and the stacktrace if enabled) should be printed.
By default, everything is printed on ERROR, but using the <code>error.handling.log-levels</code> property, this can be changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">error.handling.log-levels.400=DEBUG
error.handling.log-levels.401=INFO
error.handling.log-levels.5xx=ERROR</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration, 400 Bad Request will be printed on DEBUG level.
401 Unauthorized will be printed on INFO.
Finally, all status code in the 5xx range will be printed on ERROR.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-security"><a class="anchor" href="#spring-security"></a>3.9. Spring Security</h3>
<div class="sect3">
<h4 id="authenticationentrypoint"><a class="anchor" href="#authenticationentrypoint"></a>3.9.1. AuthenticationEntryPoint</h4>
<div class="paragraph">
<p>By default, the library will not provide a response when there is an unauthorized exception.
It is impossible for this library to provide auto-configuration for this.</p>
</div>
<div class="paragraph">
<p>There is however a class <code>io.github.wimdeblauwe.errorhandlingspringbootstarter.UnauthorizedEntryPoint</code> that you can configure in your own security configuration to get the expected behaviour.</p>
</div>
<div class="paragraph">
<p>First, define the class as a Spring bean.
Second, set the bean as the entrypoint.</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import com.fasterxml.jackson.databind.ObjectMapper;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.UnauthorizedEntryPoint;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.mapper.ErrorCodeMapper;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.mapper.ErrorMessageMapper;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.mapper.HttpStatusMapper;

import org.springframework.context.annotation.Bean;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;

</span><span class="fold-block">public class WebSecurityConfiguration {
    @Bean
    public UnauthorizedEntryPoint unauthorizedEntryPoint(HttpStatusMapper httpStatusMapper,
                                                         ErrorCodeMapper errorCodeMapper,
                                                         ErrorMessageMapper errorMessageMapper,
                                                         ObjectMapper objectMapper) { <i class="conum" data-value="1"></i><b>(1)</b>
        return new UnauthorizedEntryPoint(httpStatusMapper, errorCodeMapper, errorMessageMapper, objectMapper);
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http,
                                                   UnauthorizedEntryPoint unauthorizedEntryPoint) throws Exception {
        http.httpBasic().disable();

        http.authorizeHttpRequests().anyRequest().authenticated();

        http.exceptionHandling().authenticationEntryPoint(unauthorizedEntryPoint);<i class="conum" data-value="2"></i><b>(2)</b>

        return http.build();
    }
}
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the UnauthorizedEntryPoint as a bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the bean in the security configuration.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="accessdeniedhandler"><a class="anchor" href="#accessdeniedhandler"></a>3.9.2. AccessDeniedHandler</h4>
<div class="paragraph">
<p>Similar to the <a href="#authenticationentrypoint">AuthenticationEntryPoint</a>, there is also an <code>AccessDeniedHandler</code> implementation available at <code>io.github.wimdeblauwe.errorhandlingspringbootstarter.ApiErrorResponseAccessDeniedHandler</code>.</p>
</div>
<div class="paragraph">
<p>Example configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import com.fasterxml.jackson.databind.ObjectMapper;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.UnauthorizedEntryPoint;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.mapper.ErrorCodeMapper;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.mapper.ErrorMessageMapper;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.mapper.HttpStatusMapper;

import org.springframework.context.annotation.Bean;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;

</span><span class="fold-block">public class WebSecurityConfiguration {

    @Bean
    public AccessDeniedHandler accessDeniedHandler(HttpStatusMapper httpStatusMapper,
                                                   ErrorCodeMapper errorCodeMapper,
                                                   ErrorMessageMapper errorMessageMapper,
                                                   ObjectMapper objectMapper) { <i class="conum" data-value="1"></i><b>(1)</b>
            return new ApiErrorResponseAccessDeniedHandler(objectMapper, httpStatusMapper, errorCodeMapper, errorMessageMapper);
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http,
                                                   AccessDeniedHandler accessDeniedHandler) throws Exception {
        http.httpBasic().disable();

        http.authorizeHttpRequests().anyRequest().authenticated();

        http.exceptionHandling().accessDeniedHandler(accessDeniedHandler);<i class="conum" data-value="2"></i><b>(2)</b>

        return http.build();
    }
}
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the AccessDeniedHandler as a bean.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the bean in the security configuration.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can perfectly combine the <code>AccessDeniedHandler</code> with the <code>UnauthorizedEntryPoint</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http,
                                                   UnauthorizedEntryPoint unauthorizedEntryPoint,
                                                   AccessDeniedHandler accessDeniedHandler) throws Exception {
        http.httpBasic().disable();

        http.authorizeHttpRequests().anyRequest().authenticated();

        http.exceptionHandling()
            .authenticationEntryPoint(unauthorizedEntryPoint)
            .accessDeniedHandler(accessDeniedHandler);

        return http.build();
    }
</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handle-non-rest-controller-exceptions"><a class="anchor" href="#handle-non-rest-controller-exceptions"></a>3.10. Handle non-rest controller exceptions</h3>
<div class="paragraph">
<p>The library is setup in such a way that only exceptions coming from <code>@RestController</code> classes are handled.
This avoids that the library would interfere with <code>@Controller</code> method exceptions, if you have a mixed setup with for instance an admin backend using <code>@Controller</code> for the web interface and an actual API for a mobile app using <code>@RestController</code>.</p>
</div>
<div class="paragraph">
<p>The consequence of this is that exceptions that never hit an <code>@RestController</code> are <a href="https://github.com/spring-projects/spring-framework/issues/29120">not processed by the library</a>.
Example of such exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.springframework.web.HttpRequestMethodNotSupportedException</code></p>
</li>
<li>
<p><code>org.springframework.web.HttpMediaTypeNotSupportedException</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you would like to have support for those exceptions (and your project is only using <code>@RestController</code> classes), then you can define this class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block hide-when-folded">import io.github.wimdeblauwe.errorhandlingspringbootstarter.servlet.ErrorHandlingControllerAdvice;
import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;
import org.springframework.web.bind.annotation.ControllerAdvice;

import java.util.List;

</span><span class="fold-block">@ControllerAdvice
@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)
public class FallbackExceptionHandler extends ErrorHandlingControllerAdvice {

    public FallbackExceptionHandler(List&lt;ApiExceptionHandler&gt; handlers,
                                    FallbackApiExceptionHandler fallbackHandler,
                                    LoggingService loggingService) {
        super(handlers, fallbackHandler, loggingService);
    }
}
</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="handle-filter-exceptions"><a class="anchor" href="#handle-filter-exceptions"></a>3.11. Handle filter exceptions</h3>
<div class="paragraph">
<p>By default, the library will not handle exceptions from custom filters.
Those are implementations of <code>jakarta.servlet.Filter</code>, usually subclasses of <code>org.springframework.web.filter.OncePerRequestFilter</code> in a Spring Boot application.</p>
</div>
<div class="paragraph">
<p>By setting the property <code>error.handling.handle-filter-chain-exceptions</code> to <code>true</code>, the library will handle those exceptions and return error responses just like is done for exceptions coming from controller methods.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom-exception-handler"><a class="anchor" href="#custom-exception-handler"></a>4. Custom exception handler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the <a href="#configuration">extensive customization options</a> are not enough, you can write your own <code>ApiExceptionHandler</code> implementation.</p>
</div>
<div class="paragraph">
<p>The contract that you need to implement is defined in the <code>io.github.wimdeblauwe.errorhandlingspringbootstarter.ApiExceptionHandler</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package io.github.wimdeblauwe.errorhandlingspringbootstarter;

public interface ApiExceptionHandler {
    /**
     * Determine if this {@link ApiExceptionHandler} can handle the given {@link Throwable}.
     * It is guaranteed that this method is called first, and the {@link #handle(Throwable)} method
     * will only be called if this method returns &lt;code&gt;true&lt;/code&gt;.
     *
     * @param exception the Throwable that needs to be handled
     * @return true if this handler can handle the Throwable, false otherwise.
     */
    boolean canHandle(Throwable exception);

    /**
     * Handle the given {@link Throwable} and return an {@link ApiErrorResponse} instance
     * that will be serialized to JSON and returned from the controller method that has
     * thrown the Throwable.
     *
     * @param exception the Throwable that needs to be handled
     * @return the non-null ApiErrorResponse
     */
    ApiErrorResponse handle(Throwable exception);
}
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is also the <code>io.github.wimdeblauwe.errorhandlingspringbootstarter.handler.AbstractApiExceptionHandler</code> implementation that you can use as a base class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As an example, imagine you want to add the first-level cause of an Exception.</p>
</div>
<div class="paragraph">
<p>The implementation could look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="fold-block">package io.github.wimdeblauwe.errorhandlingspringbootstarter.handler;

</span><span class="fold-block hide-when-folded">import io.github.wimdeblauwe.errorhandlingspringbootstarter.ApiErrorResponse;
import io.github.wimdeblauwe.errorhandlingspringbootstarter.ApiExceptionHandler;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Component;

import java.util.HashMap;
import java.util.Map;

</span><span class="fold-block">@Component <i class="conum" data-value="1"></i><b>(1)</b>
public class CustomExceptionApiExceptionHandler implements ApiExceptionHandler { <i class="conum" data-value="2"></i><b>(2)</b>
    @Override
    public boolean canHandle(Throwable exception) {
        return exception instanceof CustomException; <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Override
    public ApiErrorResponse handle(Throwable exception) {
        CustomException customException = (CustomException) exception;

        ApiErrorResponse response = new ApiErrorResponse(HttpStatus.INTERNAL_SERVER_ERROR, <i class="conum" data-value="4"></i><b>(4)</b>
                                                         "MY_CUSTOM_EXCEPTION",
                                                         exception.getMessage());
        Throwable cause = customException.getCause();
        Map&lt;String, Object&gt; nestedCause = new HashMap&lt;&gt;();
        nestedCause.put("code", "CAUSE");
        nestedCause.put("message", cause.getMessage());
        response.addErrorProperty("cause", nestedCause); <i class="conum" data-value="5"></i><b>(5)</b>

        return response;
    }
}
</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Ensure your custom handler is added to the Spring context.
Easiest is just add the <code>@Component</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Implement the <code>ApiExceptionHandler</code> interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Check the exception type.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Create the <code>ApiErrorResponse</code> instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use <code>addErrorProperty</code> to add custom fields to the response.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will result in this JSON response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "code": "MY_CUSTOM_EXCEPTION",
  "message": "parent exception message",
  "cause": {
    "code": "CAUSE",
    "message": "child IOException message"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="properties"><a class="anchor" href="#properties"></a>5. Properties</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to enable or disable the error handling</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.exception-logging</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to set how the exception should be logged.
One of: <code>NO_LOGGING</code>, <code>MESSAGE_ONLY</code>,
<code>WITH_STACKTRACE</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>MESSAGE_ONLY</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.full-stacktrace-classes</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to specify a list of full qualified names of Exception classes that will always print a stack trace in the logging, regardless of the <code>error.handling.exception-logging</code> setting.
See <a href="#logging">Logging</a> for more info.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.full-stacktrace-http-statuses</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to specify a list of HTTP error codes (or ranges) that will always print a stack trace in the logging, regardless of the <code>error.handling.exception-logging</code> setting.
See <a href="#logging">Logging</a> for more info.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A fixed code like <code>500</code> can be used, or a range like <code>50x</code> or <code>5xx</code> is also possible.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.log-levels</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to specify a map of HTTP error codes (or ranges) to log levels. This allows to specify for each HTTP error code on what log level the message (and stack trace) should be printed.
See <a href="#logging">Logging</a> for more info.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A fixed code like <code>500</code> can be used, or a range like <code>50x</code> or <code>5xx</code> is also possible.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.default-error-code-strategy</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Determines how an Exception is converted into a <code>code</code> in case there is no <code>@ResponseErrorCode</code> present on the class.
One of <code>FULL_QUALIFIED_NAME</code>, <code>ALL_CAPS</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>ALL_CAPS</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.http-status-in-json-response</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Boolean that allows to add a <code>status</code> field with the HTTP response code in the response JSON body.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.http-statuses</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to set the HttpStatus response code to use for the full qualified name of an <code>Exception</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>HttpStatus.INTERNAL_SERVER_ERROR</code> is used for custom exceptions that have no specific response status set here.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.codes</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to set the code that should be used for the full qualified name of an <code>Exception</code> or the name of a validation annotation.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.messages</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows to set the message that should be used for the full qualified name of an <code>Exception</code> or the name of a validation annotation.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.search-super-class-hierarchy</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>By default, only the exact full qualified name of an <code>Exception</code> is searched for when setting <code>error.handling.http-statuses</code>, <code>error.handling.codes</code> or <code>error.handling.messages</code>.
When this is set to <code>true</code>, you can use any superclass from your <code>Exception</code> type as well.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.json-field-names.code</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The field name that is used to serialize the <code>code</code> to JSON.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>code</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.json-field-names.message</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The field name that is used to serialize the <code>message</code> to JSON.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>message</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.json-field-names.fieldErrors</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The field name that is used to serialize the <code>fieldErrors</code> to JSON.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>fieldErrors</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.json-field-names.globalErrors</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The field name that is used to serialize the <code>globalErrors</code> to JSON.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>globalErrors</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.json-field-names.parameterErrors</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The field name that is used to serialize the <code>parameterErrors</code> to JSON.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>parameterErrors</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.add-path-to-error</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This property allows to remove the <code>path</code> property in the error response when set to <code>false</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>true</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>error.handling.handle-filter-chain-exceptions</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set this to <code>true</code> to have the library intercept any exception thrown from custom filters and also have the same error responses as exceptions thrown from controller methods.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>false</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="support"><a class="anchor" href="#support"></a>6. Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have problems with the library, or you are missing a feature, feel free to create an issue on GitHub at <a href="https://github.com/wimdeblauwe/error-handling-spring-boot-starter" class="bare">github.com/wimdeblauwe/error-handling-spring-boot-starter</a>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-09-12 06:58:29 UTC
</div>
</div>
</div>
  </div>
</div>
</body>
</html>